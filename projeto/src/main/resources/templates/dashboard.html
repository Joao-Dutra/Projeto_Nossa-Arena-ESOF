<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../static/css/pages.css">
    <link rel="stylesheet" href="./../static/images/assets/fontawesome-free-6.5.2-web/fontawesome-free-6.5.2-web/css/all.css">
  
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
   <link rel="icon" href="../static/images/WhatsApp_Image_2024-07-20_at_15.43.02-removebg-preview.png">
    <title>Nossa Arena</title>
</head>
<body>
    <body>
        <nav id="sidebar">
            <div id="sidebar_content">
                <div id="user">
                    <img src="../static/images/WhatsApp_Image_2024-07-20_at_15.43.02-removebg-preview.png" id="user_avatar" alt="Avatar">
        
                    <p id="user_infos">
                        <span class="item-description">
                        Nossa Arena
                        </span>
                        <span class="item-description">
                            Software
                        </span>
                    </p>
                </div>
        
                <ul id="side_items">
                  <li class="side-item">
                    <a href="home.html">
                        <i class="fa-solid fa-house"></i>
                        <span class="item-description">Inicio</span>
                    </a>
                </li>
                  
                  </li>
                  <li class="side-item active">
                      <a href="dashboard.html">
                          <i class="fa-solid fa-chart-line"></i>
                          <span class="item-description">Dashboard</span>
                      </a>
                  </li>
                  <li class="side-item">
                    <a href="horario.html">
                        <i class="fa-solid fa-clock"></i>
                        <span class="item-description">Horarios</span>
                    </a>
                  <li class="side-item">
                    <a href="calendar.html">
                        <i class="fa-solid fa-calendar-days"></i>
                        <span class="item-description">Calendário</span>
                    </a>
                    
                  <li class="side-item">
                      <a href="cadastro.html">
                          <i class="fa-solid fa-address-card"></i>
                          <span class="item-description">Cadastro</span>
                      </a>
                  </li>
                  <li class="side-item">
                      <a href="jogadores.html">
                          <i class="fa-solid fa-futbol"></i>
                          <span class="item-description">Jogadores</span>
                      </a>
                  </li>

                  <li class="side-item">
                      <a href="#">
                          <i class="fa-solid fa-gear"></i>
                          <span class="item-description">Configurações</span>
                      </a>
                  </li>
              </ul>
              
        
                <button id="open_btn">
                    <i id="open_btn_icon" class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
            
            <div id="logout">
                <a href="index.html">
                <button id="logout_btn">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </a>
                    <span class="item-description">
                        Logout
                    </span>
                
                </button>
            </div>
        </nav>
    
        <main>

          <header>
            <h1>Nossa <span>Arena</span></h1> 
            <div class="contatos">
              <a href="https://www.instagram.com/nossarena_/"> <i class="fa-brands fa-instagram"></i></a>
    
              <p>|</p> 
              
              <a href="https://api.whatsapp.com/send/?phone=5531999575269&text=Oi!+Vim+pelo+Instagram+e+queria+informa%C3%A7%C3%B5es+sobre+a+NossArena!&type=phone_number&app_absent=0">
                <i class="fa-brands fa-whatsapp"></i></a>
              
              <p>|</p> 
              <a href="#"><i class="fa-solid fa-envelope"></i></a>
              
              <p>|</p> 
             

              <a href="#" id="phone-icon">
                  <i class="fa-solid fa-phone"></i>
              </a>
              
              <p>|</p> 
              <a href="https://www.google.com/maps/place/NossArena+Uruc%C3%A2nia/@-20.3589574,-42.7521078,17z/data=!3m1!4b1!4m6!3m5!1s0xa4b9c6f8a90ad7:0x7833dfc79ca6d117!8m2!3d-20.3589574!4d-42.7521078!16s%2Fg%2F11vjg0w6hq?entry=ttu">
                   <i class="fa-solid fa-location-dot"></i></a>
                   <div id="notification" style="display: none;">Número de telefone copiado!</div>
            </div>
           
            <img src="../static/images/WhatsApp_Image_2024-07-20_at_15.43.02-removebg-preview.png" id="user_avatar_secondary" alt="Avatar">
        </header>
        <div id="loading-screen">
        <div class="loader-container">
            <img src="../static/images/WhatsApp_Image_2024-07-20_at_15.43.02-removebg-preview.png" alt="Loading Image" class="loading-image">
            <div class="loader"></div>
        </div>
    </div>
              <div class="container">
                <div class="main-body">
                  <div class="promo_card">
                    <h1>Dashboards</h1>
                    <p>Acesso a do documentação explicativa.</p>
                    <button class="btn-download">
                      <span class="btn-text">Baixar</span>
                      <i class="fa fa-download"> </i>
                    </button>
                    
                  </div>
            
                  <div class="history_lists">
                    
                       <script>
                        
                       </script>
                    
                        <div class="table-container">
                          <h4>Histórico de Partidas</h4>  
                        
                          <table id="partidas-table">
                            <div class="filters">
                                <button id="filter-day" onclick="filterByDay()">Dia</button>
                                <button id="filter-week" onclick="filterByWeek()">Semana</button>
                                <button id="filter-month" onclick="filterByMonth()">Mês</button>
                                <button id="filter-year" onclick="filterByYear()">Ano</button>
                              </div>
                              
                            <div class="button-container">
                              <!-- Botão de Refresh -->
                              <button id="refresh-button" class="btn-refresh">
                                  <i class="fa-solid fa-arrows-rotate"></i>
                              </button>
                          </div>
                            <thead>
                              <tr>
                                <th>ID</th>
                                <th>CPF Usuário</th>
                                <th>Data da Partida</th>
                                <th>Horário</th>
                                <th>Status do Pagamento</th>
                                
                              </tr>
                            </thead>
                            <tbody>
                              <!-- Linhas da tabela serão inseridas aqui via JavaScript -->
                            </tbody>
                          </table>
                
                      </div>
                   
                <div class="sidebar">
                  <h2>Receita:</h2>
                  <div class="balance">
                      <i class="fas fa-dollar icon"></i>
                      <div class="info">
                          <h5>Diária:</h5>
                          <span class="daily">0.00</span>
                      </div>
                  </div>
                  <div class="balance">
                      <i class="fas fa-dollar icon"></i>
                      <div class="info">
                          <h5>Semanal:</h5>
                          <span class="weekly">0.00</span>
                      </div>
                  </div>
                  <div class="balance">
                      <i class="fas fa-dollar icon"></i>
                      <div class="info">
                          <h5>Mensal:</h5>
                          <span class="monthly">0.00</span>
                      </div>
                  </div>
                  <div class="balance">
                      <i class="fas fa-dollar icon"></i>
                      <div class="info">
                          <h5>Anual:</h5>
                          <span class="annual">0.00</span>
                      </div>
                  </div>
                  
              </div>
        </main>
        <script>
        
        let allData = []; // Armazena todos os dados recebidos

document.addEventListener('DOMContentLoaded', function() {
    fetch('http://localhost:8080/partidas')
        .then(response => response.json())
        .then(data => {
            allData = data; // Armazena os dados
            populateTable(allData); // Popula a tabela com os dados iniciais
        })
        .catch(error => {
            console.error('Erro ao carregar os dados:', error);
        });
});

function populateTable(data) {
    const tableBody = document.querySelector('#partidas-table tbody');
    tableBody.innerHTML = ''; // Limpa o conteúdo atual do corpo da tabela

    data.forEach(partida => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${partida.id}</td>
            <td>${partida.cpfUser || 'Não definido'}</td>
            <td>${partida.dataPartida}</td>
            <td>${partida.horario}</td>
             <td class="${partida.statusPagamento === 'Pendente' ? 'status-pendente' : (partida.statusPagamento === 'Pago' ? 'status-pago' : '')}">
                ${partida.statusPagamento}
                ${partida.statusPagamento === 'Pendente' ? `<button class="btn-pagar" onclick="marcarComoPago(${partida.id})">Marcar como Pago</button>` : ''}
            </td>
        `;
        tableBody.appendChild(row);
    });
}
// Função para remover a classe 'active' de todos os botões
function removeActiveClass() {
    const filterButtons = document.querySelectorAll('.filters button');
    filterButtons.forEach(button => {
        button.classList.remove('active');
    });
}

// Função para aplicar o filtro e ativar o botão
function applyFilter(filterFunction, buttonId) {
    removeActiveClass(); // Remove a classe 'active' de todos os botões
    document.getElementById(buttonId).classList.add('active'); // Adiciona a classe 'active' ao botão clicado
    filterFunction(); // Aplica o filtro
}

// Modifique as funções de filtro para usar applyFilter

function filterByDay() {
    applyFilter(() => {
        const today = new Date().toISOString().split('T')[0];
        const filteredData = allData.filter(partida => partida.dataPartida === today);
        populateTable(filteredData);
    }, 'filter-day');
}

function filterByWeek() {
    applyFilter(() => {
        const today = new Date();
        const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay())).toISOString().split('T')[0];
        const endOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 6)).toISOString().split('T')[0];
        const filteredData = allData.filter(partida => {
            const partidaDate = new Date(partida.dataPartida);
            return partidaDate >= new Date(startOfWeek) && partidaDate <= new Date(endOfWeek);
        });
        populateTable(filteredData);
    }, 'filter-week');
}

function filterByMonth() {
    applyFilter(() => {
        const today = new Date();
        const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
        const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).toISOString().split('T')[0];
        const filteredData = allData.filter(partida => {
            const partidaDate = new Date(partida.dataPartida);
            return partidaDate >= new Date(startOfMonth) && partidaDate <= new Date(endOfMonth);
        });
        populateTable(filteredData);
    }, 'filter-month');
}

function filterByYear() {
    applyFilter(() => {
        const today = new Date();
        const startOfYear = new Date(today.getFullYear(), 0, 1).toISOString().split('T')[0];
        const endOfYear = new Date(today.getFullYear(), 11, 31).toISOString().split('T')[0];
        const filteredData = allData.filter(partida => {
            const partidaDate = new Date(partida.dataPartida);
            return partidaDate >= new Date(startOfYear) && partidaDate <= new Date(endOfYear);
        });
        populateTable(filteredData);
    }, 'filter-year');
}

document.addEventListener('DOMContentLoaded', () => {
    carregarPartidas();
});

fetch('http://localhost:8080/partidas')
  .then(response => response.json())
  .then(partidas => {
    const hoje = new Date();
    hoje.setHours(0, 0, 0, 0); // Define a hora do dia para 00:00:00

    const diaAtual = hoje.getDate();
    const mesAtual = hoje.getMonth();
    const anoAtual = hoje.getFullYear();
    const diaSemana = hoje.getDay(); // 0 para Domingo, 6 para Sábado

    // Funções auxiliares
    const filtrarPorDia = (partida) => {
      const dataPartida = new Date(partida.dataPartida);
      dataPartida.setHours(0, 0, 0, 0); // Define a hora para 00:00:00
      return dataPartida.getTime() === hoje.getTime();
    };

    const filtrarPorSemana = (partida) => {
      const dataPartida = new Date(partida.dataPartida);
      const primeiroDiaDaSemana = new Date(hoje);
      primeiroDiaDaSemana.setDate(diaAtual - diaSemana);
      primeiroDiaDaSemana.setHours(0, 0, 0, 0);

      const ultimoDiaDaSemana = new Date(hoje);
      ultimoDiaDaSemana.setDate(diaAtual + (6 - diaSemana));
      ultimoDiaDaSemana.setHours(23, 59, 59, 999);

      return dataPartida >= primeiroDiaDaSemana && dataPartida <= ultimoDiaDaSemana;
    };

    const filtrarPorMes = (partida) => {
      const dataPartida = new Date(partida.dataPartida);
      return dataPartida.getMonth() === mesAtual && dataPartida.getFullYear() === anoAtual;
    };

    const filtrarPorAno = (partida) => {
      const dataPartida = new Date(partida.dataPartida);
      return dataPartida.getFullYear() === anoAtual;
    };

    // Cálculos
    const ganhosDiarios = partidas.filter(filtrarPorDia).length * 200;
    const ganhosSemanais = partidas.filter(filtrarPorSemana).length * 200;
    const ganhosMensais = partidas.filter(filtrarPorMes).length * 200;
    const ganhosAnuais = partidas.filter(filtrarPorAno).length * 200;

    // Logs para depuração
    console.log('Ganhos Diários:', ganhosDiarios);
    console.log('Ganhos Semanais:', ganhosSemanais);
    console.log('Ganhos Mensais:', ganhosMensais);
    console.log('Ganhos Anuais:', ganhosAnuais);

    // Inserir valores no HTML
    document.querySelector('.daily').textContent = ganhosDiarios.toFixed(2);
    document.querySelector('.weekly').textContent = ganhosSemanais.toFixed(2);
    document.querySelector('.monthly').textContent = ganhosMensais.toFixed(2);
    document.querySelector('.annual').textContent = ganhosAnuais.toFixed(2);
  })
  .catch(error => console.error('Erro ao buscar os dados:', error));
  document.addEventListener('DOMContentLoaded', () => {
    carregarPartidas();
  });

  document.addEventListener('DOMContentLoaded', () => {
    carregarPartidas();
});
function carregarPartidas() {
    fetch('http://localhost:8080/partidas')
        .then(response => response.json())
        .then(partidas => {
            const container = document.getElementById('partidas-container');
            container.innerHTML = ''; // Limpar o conteúdo anterior

            partidas.forEach(partida => {
                const partidaDiv = document.createElement('div');
                partidaDiv.classList.add('partida');
                partidaDiv.setAttribute('data-id', partida.id); // Adicionar data-id
                
                // Verificar o status de pagamento (booleano)
                const statusPagamento = partida.statusPagamento ? 'Disponível' : 'Não disponível';
                const statusClass = partida.statusPagamento ? 'disponivel' : 'nao-disponivel';
                
                // Criar o HTML para cada partida
                partidaDiv.innerHTML = `
                    <p>ID: ${partida.id} - CPF: ${partida.cpfUser} - Dia: ${partida.dataPartida} - Hora: ${partida.horario} - Status: <span class="status ${statusClass}">${statusPagamento}</span></p>
                    ${partida.statusPagamento ? `<button class="btn-marcar-indisponivel" onclick="marcarComoIndisponivel(${partida.id})">Marcar como Não disponível</button>` : ''}
                `;

                container.appendChild(partidaDiv);
            });
        })
        .catch(error => console.error('Erro ao carregar partidas:', error));
}
function marcarComoPago(id) {
    fetch(`http://localhost:8080/partidas/${id}/marcar-pago`, {
        method: 'PUT',
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erro ao marcar como pago');
        }
        return response.json();
    })
    .then(partida => {
        // Atualizar o status na interface
        const row = document.querySelector(`.partida[data-id='${id}']`);
        const statusElement = row.querySelector('.status');
        
        if (statusElement) {
            statusElement.textContent = 'Não disponível';
            statusElement.classList.remove('disponivel');
            statusElement.classList.add('nao-disponivel');
        }

        // Atualizar o botão
        const button = row.querySelector('.btn-marcar-indisponivel');
        if (button) {
            button.textContent = 'Indisponível';
            button.classList.add('indisponivel');
            button.disabled = true; // Desativar o botão após clicar
        }
    })
    .catch(error => {
        console.error('Erro ao marcar como não disponível:', error);
    });
}





        </script>
        <script src="../static/js/script.js"></script>
    <script src="../static/js/scriptpages.js"></script>
</body>
</html>